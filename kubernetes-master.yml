---
- hosts: master
  tasks:
  - name: create ssl dir
    file: path=/etc/kubernetes/ssl state=directory owner=root group=root
  - name: copy tsl certificates
    copy: src=gen-certs/certs/{{ item }} dest=/etc/kubernetes/ssl/{{ item }} owner=root group=root mode=0400
    with_items:
      - ca.pem
      - apiserver.pem
      - apiserver-key.pem
  - name: create flannel run dir
    file: path=/run/flannel state=directory
  - name: write flannel options
    copy: src=flannel/options.env dest=/run/flannel/options.env
  - name: create docker unit drop-in dir
    file: path=/etc/systemd/system/docker.service.d state=directory
  - name: write docker flannel dependency drop-in
    copy: src=flannel/40-flannel.conf dest=/etc/systemd/system/docker.service.d/40-flannel.conf
